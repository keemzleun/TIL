### 영속성 컨텍스트란

- 엔티티를 영구 저장하는 환경이라는 뜻
- 애플리케이션과 데이터베이스 사이에서 객체를 보관하는 가상의 데이터베이스 같은 역할
- 엔티티 매니저를 통해 엔티티를 저장하거나 조회하면 엔티티 매니저는 영속성 컨텍스트에 엔티티를 보관하고 관리함


- `em.persist(member);` 엔티티 매니저를 사용해 회원 엔티티를 영속성 컨텍스트에 저장한다는 의미


- 특징
    - 엔티티 매니저를 생성할 때 하나 만들어짐
    - 엔티티 매니저를 통해서 영속성 컨텍스트에 접근하고 관리할 수 있음


### 영속성 컨텍스트를 사용하는 이유

1. 캐싱(1차 캐시)

   ex) 데이터를 조회하는 기능을 처리할 때, DB에서 바로 조회하는 것이 아니라 영속성 컨텍스트에서 먼저 조회

2. 영속된 엔티티의 동일성 보장(1차 캐시의 연장선)

   ex) 영속되어 있는 동일한 id를 갖는 엔티티를 2번 조회한다고 가정했을 때, 조회된 각각의 객체는 동일한 주소값을 가짐. 즉, 정확히 동일한 객체임

3. 쓰기 지연

   ex) 트랜잭션을 commit하는 순간에 영속성 컨텍스트의 엔티티에 대한 쿼리를 DB에 실행

4. 변경 감지(Dirty checking)

   ex) 영속된 엔티티를 수정하면, 트랜잭션이 commit되는 순간 변경 쿼리가 DB에 실행됨